Array.prototype.last=function(t){return t=t||1,this.length-t<0?this[0]:this[this.length-t]};var now="undefined"!=typeof performance?function(){return performance.now()}:function(){return+new Date},utils=Object.freeze({now:now}),nextFrame=requestAnimationFrame,subscribers={},id=0,isTicking=!1,getId=function(){return id++},add=function(t){var i="clock_"+getId();return subscribers[i]=t,isTicking||tick(),i},remove=function(t){subscribers[t]&&delete subscribers[t]},tick=function t(){var i=Object.keys(subscribers);if(0===i.length)isTicking=!1;else{var e=now();i.forEach(function(t){subscribers[t](e)}),nextFrame(t),isTicking=!0}},Clock={add:add,remove:remove},classCallCheck=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},_extends=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},Tween=function(){function t(i){classCallCheck(this,t),this.startTime=0,this.currentTime=0,this.percent=0,this.setOptions(i),this.step=this.step.bind(this)}return t.prototype.setOptions=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.duration,e=void 0===i?0:i;this.duration=e,this.options=_extends({},this.options,t)},t.prototype.start=function(){this.startTime=this.currentTime=now(),this.clockId=Clock.add(this.step)},t.prototype.stop=function(){Clock.remove(this.clockId),this.clockId=null,this.percent=0,this.options.onEnd&&this.options.onEnd(this),console.log("tween stop")},t.prototype.step=function(t){this.currentTime=t;var i=t-this.startTime,e=!1;this.duration-i>0?this.percent=i/this.duration:(this.percent=1,e=!0),this.options.onStep&&this.options.onStep(this,this.percent),e&&this.stop()},t}(),Deceleration=function(){function t(i){classCallCheck(this,t),this.step=this.step.bind(this),this.setOptions(i)}return t.prototype.setOptions=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.velocity,e=t.resistance,s=void 0===e?.001:e;return i&&(this.velocity=i),this.resistance=s,this.options=_extends({},this.options,t),this},t.prototype.start=function(){return this.startTime=this.prevTime=this.currentTime=now(),this.sign=this.velocity>0?1:-1,this.prevV=Math.abs(this.velocity),this.clockId=Clock.add(this.step),this},t.prototype.stop=function(){return Clock.remove(this.clockId),this.clockId=null,console.log("deceleration stop"),this.options.onEnd&&this.options.onEnd(),this},t.prototype.step=function(t){this.currentTime=t;var i=t-this.prevTime,e=this.prevV;if(e<=0)console.log("will stop dec",e),e=0,this.stop();else{var s=e*i-this.resistance*Math.pow(i,2)/2;console.log(this.sign*s,e),this.options.onStep&&this.options.onStep(this.sign*s),this.prevTime=this.currentTime,this.prevV=this.prevV-this.resistance*i}},t}(),index={Clock:Clock,Tween:Tween,Deceleration:Deceleration};export default index;export{utils as Utils,Clock,Tween,Deceleration};
