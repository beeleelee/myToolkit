<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/internal/_date.js | mytoolkit</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="my javascript toolkit"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="mytoolkit"><meta property="twitter:description" content="my javascript toolkit"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/deceleration.js~Deceleration.html">Deceleration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/tween.js~Tween.html">Tween</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-IDFactory">IDFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addComma">addComma</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addKey">addKey</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-charLength">charLength</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-currentTime">currentTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deepCopy">deepCopy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isEmail">isEmail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSet">isSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isUInt">isUInt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-padZero">padZero</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randInt">randInt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randStr">randStr</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setStyle">setStyle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-strToDate">strToDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-strToTime">strToTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timeToStr">timeToStr</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timestamp">timestamp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-trim">trim</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typeOf">typeOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-performanceNow">performanceNow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-_tick">_tick</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#internal">internal</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_dateConvert">_dateConvert</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_padEnd">_padEnd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_padStart">_padStart</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/internal/_date.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import typeOf from &apos;../typeOf&apos;
import currentTime from &apos;../currentTime&apos;
import padZero from &apos;../padZero&apos;
import isUInt from &apos;../isUInt&apos;

const supportedFormats = [
  &apos;yyyy-mm-dd hh:mm:ss&apos;,
  &apos;yyyy-mm-dd hh:mm&apos;,
  &apos;yyyy-mm-dd&apos;,
  &apos;yyyy-mm&apos;,
  &apos;hh:mm:ss&apos;,
  &apos;hh:mm&apos;
]
const supportedTargetTypes = [
  &apos;seconds&apos;,
  &apos;miniseconds&apos;,
  &apos;date&apos;,
  &apos;dateString&apos;,
]

/**
 * the converter of date
 * 
 */

/**
 * 
 * @param {String|Number|Date} from - input to be convert
 * @param {String} targetType - output types (seconds|miniseconds|date|dateString)
 * @param {String} [format] - supported format as follow:
 *                          &apos;yyyy-mm-dd hh:mm:ss&apos;
 *                          &apos;yyyy-mm-dd hh:mm&apos;
 *                          &apos;yyyy-mm-dd&apos;
 *                          &apos;yyyy-mm&apos;
 *                          &apos;hh:mm:ss&apos;
 *                          &apos;hh:mm&apos;
 */

export function _dateConvert(from = currentTime(), targetType = &apos;dateString&apos;, format = &apos;yyyy-mm-dd hh:mm&apos;) {
  let fromType = typeOf(from)
  switch(fromType){
  case &apos;String&apos;:
  case &apos;Number&apos;:
    if(isUInt(from)){
      return secondsConvert(ensureMiniseconds(from), targetType, format)
    }
    return DSConvert(from, targetType)
  case &apos;Date&apos;:
    return DConvert(from, targetType, format)
  default:
    throw new TypeError(`_dateConvert - unexpected type of ${fromType}`)   
  }
}

function secondsConvert(from, targetType, format) {
  if(!(targetType === &apos;date&apos; || targetType === &apos;dateString&apos;)){
    throw new TypeError(`unexpected targetType: ${targetType}`)
  }

  let d = new Date()
  d.setTime(from)
  if(targetType === &apos;date&apos;){
    return d 
  }

  return toDS(d, format)
}

function DSConvert(from, targetType) {
  if (!supportedTargetTypes.includes(targetType)) {
    throw new TypeError(`unexpected targetType: ${targetType}`)
  }
  if(targetType === &apos;dateString&apos;){
    return from 
  }
  let reg1 = /^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/
  let reg2 = /^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2})$/
  let reg3 = /^(\d{4})-(\d{2})-(\d{2})$/
  let reg4 = /^(\d{4})-(\d{2})$/
  let reg5 = /^(\d{2}):(\d{2}):(\d{2})$/
  let reg6 = /^(\d{2}):(\d{2})$/
  let today = new Date()
  let DS = String(from)
  let match, d
  if(match = DS.match(reg1)){
    d = new Date(match[1], match[2] - 1, match[3], match[4], match[5], match[6])
  }
  if(match = DS.match(reg2)){
    d = new Date(match[1], match[2] - 1, match[3], match[4], match[5])
  }
  if(match = DS.match(reg3)){
    d = new Date(match[1], match[2] - 1, match[3])
  }
  if(match = DS.match(reg4)){
    d = new Date(match[1], match[2] - 1)
  }
  if(match = DS.match(reg5)){
    d = new Date(today.getFullYear(), today.getMonth(), today.getDate(), match[1], match[2], match[3])
  }
  if(match = DS.match(reg6)){
    d = new Date(today.getFullYear(), today.getMonth(), today.getDate(), match[1], match[2])
  }
  if(!d){
    throw new Error(&apos;unexpected input!&apos;)
  }
  if(targetType === &apos;seconds&apos;){
    return Math.round(d.getTime() / 1000)
  }
  if(targetType === &apos;miniseconds&apos;){
    return d.getTime()
  }
  return d 
}

function DConvert(from, targetType, format) {
  switch(targetType) {
  case &apos;seconds&apos;:
    return Math.round(from.getTime() / 1000)
  case &apos;miniseconds&apos;:
    return from.getTime()
  case &apos;dateString&apos;:
    return toDS(from, format) 
  default:
    throw new TypeError(`_dateConvert - unexpected type of ${targetType}`)
  }
}

function ensureMiniseconds(number) {
  if((number + &apos;&apos;).length === 10){
    return number * 1000
  }
  return number
}

function toDS(d, format) {
  if(typeOf(d) !== &apos;Date&apos;){
    throw new TypeError(`unexpected type: ${typeOf(d)}`)
  }
  if (!supportedFormats.includes(String(format).toLowerCase())) {
    throw new TypeError(`unexpected format! suported formats: \n${supportedFormats.join(&apos;\n&apos;)}`)
  }

  let year, month, date, hours, minutes, seconds,
    dateString = format
  
  year = d.getFullYear()
  month = d.getMonth() + 1
  date = d.getDate()
  hours = d.getHours()
  minutes = d.getMinutes()
  seconds = d.getSeconds()

  dateString = dateString.replace(/yyyy/i, year)
  dateString = dateString.replace(/-mm/i, `-${padZero(month)}`)
  dateString = dateString.replace(/dd/i, padZero(date))
  dateString = dateString.replace(/hh/i, padZero(hours))
  dateString = dateString.replace(/:mm/i, `:${padZero(minutes)}`)
  dateString = dateString.replace(/ss/i, padZero(seconds))

  return dateString
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
